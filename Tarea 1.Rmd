---
title: "Tarea 1- Ejercicios 3 y 4 "
author: "Eliza Zenteno"
date: "8/19/2020"
output: html_document

---
```{r}
library(tidyverse)
```

##Ejercicio 3: 

Cargamos el conjunto de datos `iris`.

```{r}
data(iris3)
```

a) Calcular $\boldsymbol{\bar{x}}$, la matriz de sumas de cuadrados corregida por la media $\boldsymbol{A}$ y la matriz de covarianza insesgada $S_X$.

```{r iris}
#3a:
#Cargamos datos de Iris y librerias de manejo de databases
datos <- as.data.frame(iris3)
#Tomamos la matriz con datos correspondientes a la especie Setosa.
X <- as.matrix(datos[,1:4])
m <- nrow(X)
uno <- rep(1,m)

#Calculamos x barra
suma_setosa <- colSums(X)
media_setosa <- suma_setosa/m
names(media_setosa)[] = "Media"

#Calculamos la matriz A
aux <- diag(m)-uno%*%t(uno)/m
A <- t(X) %*% aux %*% X

#Matriz de covarianza muestral insesgada
S_x <- (1/49)*A

```

b)Obtener eigenvalores y eigenvectores de $\boldsymbol{S}$.
```{r}
spec <- eigen(S_x)
e_valores <- as.vector(spec[[1]])
```

c)Sea $U$ la matrix de eigenvectores de $S$ y $L$ la matriz cuadrada cuyas entradas en la diagonal son los eigenvalores. 
```{r}
U <- as.matrix(spec[[2]]) #matriz de eigenvectores
L <- diag(e_valores,4)
```

Demostramos numéricamente que $\boldsymbol{ULU'}=\boldsymbol{S}$ 

Para ello calcularemos la norma euclideana de la diferencia de matrices y notemos que dichas cantidades son casi cero.
```{r}
norm(U%*%L%*%t(U) - S_x)
```

Vemos también que $\boldsymbol{ULU'}$ y $\boldsymbol{S}$ son prácticamente iguales. 
```{r}
U%*%L%*%t(U)
S_x
```

Observamos que $\boldsymbol{U'U}=\boldsymbol{UU'}=\boldsymbol{I}_4$.(Se tomó un redondeo de 3 dígitos)
```{r}
round(U%*%t(U),3)#UU'# 
round(t(U)%*%U,3)#U'U
```

Obtener matriz de gráficas de dispersión de las cuatro variables para cada variedad de
iris, todo en la misma gráfica.
```{r Setosa}
colores <- c("blue", "chartreuse", "aquamarine")
species <- names(iris3[1,1,])
pairs(rbind(iris3[,,1],iris3[,,2],iris3[,,3]), 
      col=colores[gl(3,50,labels = species)], pch = 19,  cex = 0.5 )
```

##Ejercicio 4: 

Usar los datos del ejercicio anterior.

Considerando $Y=\begin{pmatrix}y_1 & y_2  & y_3  & y_4  & y_5\end{pmatrix}$ donde $y_i$ representa la $i$-ésima columna de $Y$ cuyas primeras cuatro columnas sean las mismas que X y cuya última columna es Petal L. + Petal W. con una matriz $C$ tal que $Y=XC$. 

Tomamos $C$ de la forma:
$$C=\begin{pmatrix}1&0&0&0&0\\0&1&0&0&0\\0&0&1&0&1\\0&0&0&1&1\end{pmatrix}$$
```{r pressure, echo=FALSE}
C<- cbind((diag(4)),c(0,0,1,1))
Y<- X%*%C
head(Y)
```

b)Calcular la matriz de covarianzas muestral $S_Y$ y sus eigenvalores y eigenvectores
```{r}
n <- nrow(Y)
unoY <- rep(1,n)

#Calculamos y barra
sumaY <- colSums(Y)
media_Y <- sumaY/n

#Calculamos la matriz A
auxY <- diag(n)-uno%*%t(uno)/n
A_Y <- t(Y) %*% auxY %*% Y

#Matriz de covarianza muestral insesgada
S_y <- (1/49)*A_Y

#eigenvalores y eigenvectores
(spec_y <- eigen(S_y))
```

Notemos que el valor más  pequeño de los eigenvalores es _cercano_ a cero. De la misma forma, la variable `comb_lin` toma la combinación lineal de las columnas de $Y$ cuyos pesos son las entradas del eigenvector correspondiente al eigenvalor más pequeño. Así podemos ver que la varianza de las entradas de `comb_lin` es _casi_ cero.
```{r}
min(spec_y$values)
comb_lin <- numeric(dim(S_y)[1])
for (i in 1:dim(S_y)[1]) {
  comb_lin <- comb_lin + spec_y$vectors[i,5]*Y[,i]
}
var(comb_lin)
```

c)Tambi[en se puede calcular la varianza muestral$S_Y$ a partir de $C'S_XC$.  Notemos que la norma euclideana de la diferencia entre las matrices  y  es _casi_ cero.
```{r}
aprox <- t(C)%*%S_x%*%C
norm(aprox - S_y)
```

